/**
 * 喜忌判断工具
 * 根据日主五行和出生月份，判断喜忌
 */

// 天干对应的五行
export const TIANGAN_WUXING: { [key: string]: string } = {
  '甲': '木', '乙': '木',
  '丙': '火', '丁': '火',
  '戊': '土', '己': '土',
  '庚': '金', '辛': '金',
  '壬': '水', '癸': '水'
};

// 月份对应的季节
// 寅卯月=春，巳午月=夏，申酉月=秋，亥子月=冬，辰戌丑未=四季
export const MONTH_SEASON: { [key: string]: string } = {
  '寅': '春', '卯': '春',
  '巳': '夏', '午': '夏',
  '申': '秋', '酉': '秋',
  '亥': '冬', '子': '冬',
  '辰': '四季', '戌': '四季', '丑': '四季', '未': '四季'
};

// 喜忌结果接口
export interface XijiResult {
  wuxing: string;       // 日主五行
  season: string;       // 出生季节
  title: string;        // 标题
  verse: string;        // 赋文
  analysis: string;     // 解析
}

/**
 * 获取喜忌信息
 * @param dayTiangan 日干
 * @param monthDizhi 月支
 */
export function getXiji(dayTiangan: string, monthDizhi: string): XijiResult | null {
  const wuxing = TIANGAN_WUXING[dayTiangan];
  const season = MONTH_SEASON[monthDizhi];

  if (!wuxing || !season) return null;

  const data = SIJIGE_DATA[wuxing]?.[season];
  if (!data) return null;

  return {
    wuxing,
    season,
    ...data
  };
}

// 四季歌赋文数据
export const SIJIGE_DATA: { [wuxing: string]: { [season: string]: { title: string; verse: string; analysis: string } } } = {
  '木': {
    '春': {
      title: '木日主生春天',
      verse: `木生春月旺，水多主灾殃。
不是贫困守，就是少年亡。
最喜戊己土，见火大吉昌。
见官反无官，庚辛命不强。`,
      analysis: '春季木旺，但仍残存寒气，所以水多不吉，喜戊己土克水，或者火来抵御寒气。'
    },
    '夏': {
      title: '木日主生夏天',
      verse: `夏木不为凋，火炎怕土燥，
火盛要水养，水盛木则漂。
最喜见寅卯，子辰亦为好，
财官若根轻，午未运不高。`,
      analysis: '夏季木休。水火平衡：水是救星（制火），但忌过量（水多木漂）。扎根第一：地支见寅卯（木根）、子辰（水润）为最佳配置。'
    },
    '四季': {
      title: '木日主生四季月',
      verse: `木生四季月，怎把戊己克，
但求壬癸水，反宜金叠叠，
丑辰须用火，未戌水木扶，
全是火土现，土运亦为安。`,
      analysis: '绝不硬刚：土旺时木别妄想克土，优先求水（生木）+ 金（生水泄土）。丑辰寒土用火暖局，未戌燥土用水木扎根。'
    },
    '秋': {
      title: '木日主生秋月',
      verse: `秋木逢旺金，金旺及伤身，
不宜重见土，干头爱丙丁。
金木若相战，财运反遭陷，
壬癸若相助，定然名利亨。`,
      analysis: '头号救星：丙丁火→克金护身+暖局解冻。二号救星：壬癸水→泄金生木+润局养根（杀印相生贵格）。'
    },
    '冬': {
      title: '木日主生冬月',
      verse: `冬木枯叶调，水冷怕金削。
有土相逢火，温暖发根苗。
冬天水木泛，名利总虚无。
运逢火土助，名利才自如。`,
      analysis: '首需火土：火是命根（无火必败），土是基石（制水培木）。大忌金水：金生水更寒，水多木漂。'
    }
  },
  '火': {
    '春': {
      title: '火日主生春天',
      verse: `火到春见阳，木盛火必强。
水旺金不旺，富贵理应当。
火多木必焚，最喜见官乡。
支中见多卯，反倒为灾殃。`,
      analysis: '火命春生，木火要适度，太旺需水来调。'
    },
    '夏': {
      title: '火日主生夏天',
      verse: `夏火非寻常，木多主不祥。
水旺要金相，方才显高强。
火盛土必燥，无水焉能好。
宜壬不宜癸，不须寅卯绕。`,
      analysis: '夏季火旺，木可助燃，有水方为水火相济，喜水；金为火之财星，金强可使财运旺盛。'
    },
    '四季': {
      title: '火日主生四季月',
      verse: `火生四季衰，水多常有害。
用金不和谐，甲己喜相爱。
未戌多孤寡，丑辰是良才。
休逢戊己旺，必定有祸殃。`,
      analysis: '火在四季末最弱。忌水金：水克火，金耗火。喜：甲木（生火）+己土（制水）。丑辰湿土为良才。'
    },
    '秋': {
      title: '火日主生秋天',
      verse: `秋月火不强，唯喜甲丙帮。
用木还用土，土重则为殃。
岁运逢火地，自然财兴旺。
水盛最无情，不夭眼目盲。`,
      analysis: '秋季火属囚势，喜木得木生火可助其势；土可制水也喜土，但土过多则土多火晦。'
    },
    '冬': {
      title: '火日主生冬天',
      verse: `火生冬不旺，四柱怕金乡。
爱用甲乙木，干适戊己乡。
人生若逢此，必定是官郎。
只恐财杀旺，刑冲见阎王。`,
      analysis: '火在冬天死绝之气，喜欢用木生火，用土克水。不喜金（生水耗火）+ 水（杀）无制。'
    }
  },
  '土': {
    '春': {
      title: '土日主生春天',
      verse: `春月生戊己，难抵甲和乙。
用金必有利，有火方是奇。
不愁春水旺，身衰反无依。
水火两相济，方能有名利。`,
      analysis: '救急靠金：砍伐压制你的木。扎根靠火：火是命根（生土抗木）。发财靠水平衡。'
    },
    '夏': {
      title: '土日主生夏天',
      verse: `戊己夏月生，干头喜见金。
旺遇火丙丁，无水不显荣。
水火名既济，戊己得安生。
但愁木火土，焦躁身不宁。`,
      analysis: '救命核心：金水→金泄土生水，水制火润燥。格局关键：水火既济。大忌组合：木火土。'
    },
    '四季': {
      title: '土日主生四季土月',
      verse: `四季戊己旺，不宜火焰乡。
甲乙喜相逢，用水定吉昌。
丑辰单用火，卯旺名声扬。
戌未水木乡，戊己忌再帮。`,
      analysis: '通病：土过旺→首需木疏土、水润局。寒土（丑辰）补小火暖局，燥土（未戌）补水木扎根。'
    },
    '秋': {
      title: '土日主生秋天',
      verse: `秋月逢戊己，金旺泻土气。
用火方成器，用水不相宜。
此时愁木旺，怎能无灾殃。
或是遭人欺，或是有残疾。`,
      analysis: '唯一救星：火→制金（防泄气）+ 生土（补元气）。大忌：金、木、水。'
    },
    '冬': {
      title: '土日主生冬季',
      verse: `戊己逢冬生，见金则不荣。
甲乙虽为病，有火是公卿。
支中若无根，为人定漂流。
须得戊己帮，亥子是财乡。`,
      analysis: '最佳配置：土（堤坝）+ 火（能源）→化洪水为资源。大忌组合：金（生水助洪）+ 水（泛滥）。'
    }
  },
  '金': {
    '春': {
      title: '金日主生春天',
      verse: `金生春月地，焉能用甲乙。
用土还伤火，无伤不为奇。
金木若相战，两丁名利齐。
若是喜水旺，休囚苦无依。`,
      analysis: '财（木）宜少不宜多→防财多压身。金木交战，用火通关→丁火炼金成器。水旺则金沉。'
    },
    '夏': {
      title: '金日主生夏天',
      verse: `庚辛夏月生，每朝遇丙丁。
休用甲乙木，壬癸水担承。
不宜再逢火，火旺金必溶。
戊己土来帮，必定名利亨。`,
      analysis: '头号死敌：木火→木生火＝送柴入炉。救命恩人：水→水降温。终极贵人：湿土（丑辰）。'
    },
    '四季': {
      title: '金日主生四季土月',
      verse: `四季旺生金，母旺子相生。
用木正用水，单怕水埋金。
戌未逢旺火，见水得安生。
丑辰用丙丁，木乡有名声。`,
      analysis: '土旺生金，用木疏土、用水泄秀。戌未燥土见水得安生，丑辰湿土用丙丁火。'
    },
    '秋': {
      title: '金日主生秋天',
      verse: `秋月金旺重，水土两无功。
问君何所用，最喜财官逢。
旺火铸金钟，岁逢名利通。
英惑无根气，贫贱九流同。`,
      analysis: '金山要变宝，烈火不能少！火旺炼金方成器（名利亨通），火弱无根是废料（贫贱困顿）。'
    },
    '冬': {
      title: '金日主生冬天',
      verse: `庚辛产于冬，冬水旺无穷。
水旺金必沉，早亡少壮童。
支安根禄重，印生始太平。
虽然喜逢土，无火不显荣。`,
      analysis: '救命根：申酉戌（地支强根）。保命符：湿土（丑辰土制水生金）。发达钥：暖火（丙丁午解冻炼金）。'
    }
  },
  '水': {
    '春': {
      title: '水日主生春天',
      verse: `春水不当权，木盛夺水源。
用金礼相见，见火乐封源。
水木伤官格，喜见财与官。
水木两相见，空来人世间。`,
      analysis: '春季木旺，水休。春季还有余寒，所以用土制水寒，火也能生土，喜火土。'
    },
    '夏': {
      title: '水日主生夏天',
      verse: `水生夏月天，木多火炎炎。
休言财官旺，只要不枯源。
金水若相涵，名利两相欢。
土燥金不见，不能成方圆。`,
      analysis: '救命稻草：金→唯一水源（无金必败）。格局核心：金水相涵→金生水润局。致命雷区：木多、土燥无金、火旺无制。'
    },
    '四季': {
      title: '水日主生四季土月',
      verse: `水生四季弱，土旺不相合。
用金愁逢火，用木怕金多。
土旺恶煞侵，一命见阎罗。
丑辰是其根，戌未最怕火。`,
      analysis: '最佳配置：丑/辰土（湿土）+ 金（生水）→通关化解。死亡组合：未戌土（燥土）+ 火→火土焦躁，水绝人亡。'
    },
    '秋': {
      title: '水日主生秋天',
      verse: `秋水通源长，金多水必旺。
喜木来泄秀，用火方为上。
土厚反无功，金水两茫茫。
最怕金水盛，身弱反遭殃。`,
      analysis: '秋季金旺生水，水势渐强。喜木泄秀、火暖局。忌金水太过，反成泛滥。'
    },
    '冬': {
      title: '水日主生冬天',
      verse: `冬水旺无穷，金木两无功。
干透戊己土，富贵丙丁逢。
但愁金水旺，父星反遭冲。
祖业难有靠，扎根火土中。`,
      analysis: '最佳配置：土（堤坝）+ 火（能源）→化洪水为资源。大忌组合：金（生水助洪）+ 水（泛滥）。'
    }
  }
};

